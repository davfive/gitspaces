name: "CI â€” Python Tests (all supported versions)"

on:
  workflow_dispatch: {}
  workflow_call: {}
  pull_request:
    branches: [ main ]

jobs:
  vars:
    uses: ./workflows/vars.yml

  static:
    needs: vars
    uses: ./.github/workflows/static-checks.yml
    with:
      run-security: true
      python-for-tools: ${{ needs.vars.outputs.python_versions_latest }}
    permissions:
      contents: read

  test:
    needs: [vars, static]
    name: test-${{ replace(matrix.platform.os, '-latest', '') }}.${{ matrix.platform.shell }}.${{ replace(needs.vars.outputs.python_versions_all, ',', '-') }}
    runs-on: ${{ matrix.platform.os }}
    strategy:
      fail-fast: false
      matrix:
        platform:
          - os: ubuntu-latest
            shell: bash
          - os: macos-latest
            shell: bash
          - os: windows-latest
            shell: pwsh
          - os: windows-latest
            shell: cmd
          - os: windows-latest
            shell: wsl-bash

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run Python tests (all)
        uses: ./.github/actions/python-tests
        with:
          shell: ${{ matrix.platform.shell }}
          python-versions: ${{ needs.vars.outputs.python_versions_all }}
          os: ${{ matrix.platform.os }}