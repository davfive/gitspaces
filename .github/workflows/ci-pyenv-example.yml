name: "CI - Python Tests with pyenv (Example)"

on:
  workflow_dispatch:
    inputs:
      python_versions:
        description: "JSON array of Python versions (e.g., '[\"3.13\",\"3.12\"]')"
        required: false
        default: '["3.13"]'

permissions:
  contents: read

jobs:
  vars:
    uses: ./.github/workflows/vars.yml

  test:
    needs: vars
    name: "test--${{ matrix.platform.os }}.${{ matrix.platform.shell }}.py${{ matrix.python-version }}"
    runs-on: ${{ matrix.platform.os }}
    permissions:
      contents: read
    strategy:
      fail-fast: false
      matrix:
        python-version: ${{ fromJson(inputs.python_versions || needs.vars.outputs.python_versions_latest) }}
        platform:
          - os: ubuntu-latest
            shell: bash
          - os: macos-latest
            shell: bash
          - os: windows-latest
            shell: pwsh
          - os: windows-latest
            shell: cmd
          - os: windows-latest
            shell: wsl-bash

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run Python tests
        uses: ./.github/actions/python-tests
        with:
          python-version: ${{ matrix.python-version }}
          shell: ${{ matrix.platform.shell }}
          os: ${{ matrix.platform.os }}
