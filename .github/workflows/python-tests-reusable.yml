# Reusable workflow: .github/workflows/python-tests-reusable.yml
# Called by caller workflows via "uses: ./.github/workflows/python-tests-reusable.yml"
on:
  workflow_call:
    inputs:
      matrix:
        required: true
        type: string

jobs:
  test:
    strategy:
      fail-fast: false
      matrix: ${{ fromJson(inputs.matrix) }}
    runs-on: ${{ matrix.os }}
    permissions:
      contents: read

    defaults:
      run:
        shell: ${{ matrix.shell == 'cmd' && 'cmd' || matrix.shell == 'pwsh' && 'pwsh' || matrix.shell == 'wsl-bash' && 'wsl-bash {0}' || 'bash' }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      # Delegate all WSL-specific steps into local composite action
      - name: WSL steps (composite)
        if: ${{ matrix.shell == 'wsl-bash' }}
        uses: ./.github/actions/python-tests/test-steps-wsl
        with:
          python-version: ${{ matrix.python-version }}
          os: ${{ matrix.os }}

      # Delegate non-WSL steps into local composite action
      - name: Non-WSL steps (composite)
        if: ${{ matrix.shell != 'wsl-bash' }}
        uses: ./.github/actions/python-tests/test-steps
        with:
          python-version: ${{ matrix.python-version }}
          os: ${{ matrix.os }}
